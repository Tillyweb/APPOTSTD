<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì OT ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (Summary Update)</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- SheetJS for XLSX Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f3f4f6;
        }

        /* Screen Only Styles */
        .screen-page {
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            max-width: 1100px; /* Wider for landscape simulation on screen */
            margin-left: auto;
            margin-right: auto;
        }

        /* Default: Hide print-only elements on screen */
        .print-only {
            display: none;
        }

        /* Print Styles - Critical for Layout */
        @media print {
            @page {
                size: A4 landscape; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
                margin: 1cm; /* ‡∏Ç‡∏≠‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© */
            }

            body {
                background-color: white;
                -webkit-print-color-adjust: exact !important; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
                print-color-adjust: exact !important;
            }

            .no-print {
                display: none !important;
            }

            .print-only {
                display: block !important;
            }

            /* ‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤ */
            .page-break {
                page-break-after: always !important;
                break-after: page !important;
                display: block;
                min-height: 95vh; /* ‡∏î‡∏±‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå */
                position: relative;
                width: 100%;
            }

            /* ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î */
            .page-break:last-child {
                page-break-after: avoid !important;
                break-after: avoid !important;
                min-height: auto;
            }

            .employee-container {
                background-color: white;
                width: 100%;
                padding: 0;
                margin: 0;
                border: none;
                box-shadow: none;
            }

            /* ‡∏õ‡∏£‡∏±‡∏ö Input ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤‡∏ï‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå */
            input {
                border: none !important;
                background: transparent !important;
                padding: 0 !important;
                margin: 0 !important;
            }
        }
        
        input {
            border: none !important;
            background: transparent !important;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;
        
        // --- Configuration ---
        const SCAN_SHEET_ID = '1PVm8Jw-fiY-EZNlIg2LjGSeBMrNTjOXPEXf3uF0BIKU';
        const SCAN_SHEET_CSV_URL = `https://docs.google.com/spreadsheets/d/${SCAN_SHEET_ID}/export?format=csv`;

        const SALARY_SHEET_ID = '14AW4CREadTyd6G9f6wffUgVaxxfzLWzX5qL71Axyqys';
        const SALARY_SHEET_CSV_URL = `https://docs.google.com/spreadsheets/d/${SALARY_SHEET_ID}/export?format=csv`;

        const DAILY_WAGE_RATE = 400;
        const LOGISTICS_PREMIUM_HOURS = 0.5; // OT ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå

        // --- Mock Data ---
        const SAMPLE_SCAN_DATA = `kajonhsak,1001,26-Sep-2025,08:14
kajonhsak,1001,26-Sep-2025,18:00
kajonhsak,1001,27-Sep-2025,07:50
kajonhsak,1001,27-Sep-2025,12:00
kajonhsak,1001,27-Sep-2025,13:10
kajonhsak,1001,27-Sep-2025,17:00
somying,1002,26-Sep-2025,17:45
mana,1003,26-Sep-2025,08:00
daily_worker,1004,26-Sep-2025,07:55
daily_worker,1004,26-Sep-2025,17:00
daily_worker,1004,27-Sep-2025,08:00
daily_worker,1004,27-Sep-2025,17:00
logistics_guy,1005,26-Sep-2025,08:00
logistics_guy,1005,26-Sep-2025,17:00`;

        const SAMPLE_SALARY_DATA = `1001,kajonhsak,"15,000",‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
1002,somying,18000,‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
1003,mana,12000,‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
1004,daily_worker,0,‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
1005,logistics_guy,16000,‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå`;

        // --- Helper Functions ---
        const parseLine = (line) => {
            if (!line) return [];
            if (line.includes('\t')) return line.split('\t').map(c => c.trim().replace(/^"|"$/g, ''));
            const regex = /,(?=(?:(?:[^"]*"){2})*[^"]*$)/;
            return line.split(regex).map(c => c.trim().replace(/^"|"$/g, ''));
        };

        const MONTH_MAP = {
            jan: 0, feb: 1, mar: 2, apr: 3, may: 4, jun: 5,
            jul: 6, aug: 7, sep: 8, oct: 9, nov: 10, dec: 11
        };

        const parseDate = (dateStr) => {
            if (!dateStr) return new Date();
            if (dateStr.includes('/')) {
                const parts = dateStr.split('/');
                if (parts.length === 3) return new Date(parts[2], parts[1] - 1, parts[0]);
            }
            if (dateStr.includes('-')) {
                const parts = dateStr.split('-');
                if (parts.length === 3) {
                    const day = parseInt(parts[0], 10);
                    const monthStr = parts[1].toLowerCase();
                    const year = parseInt(parts[2], 10);
                    if (MONTH_MAP.hasOwnProperty(monthStr)) {
                        return new Date(year, MONTH_MAP[monthStr], day);
                    }
                }
            }
            const d = new Date(dateStr);
            return isNaN(d.getTime()) ? new Date() : d;
        };

        const formatDate = (dateObj) => {
            const d = dateObj.getDate().toString().padStart(2, '0');
            const m = (dateObj.getMonth() + 1).toString().padStart(2, '0');
            const y = dateObj.getFullYear();
            return `${d}/${m}/${y}`;
        }

        const isSunday = (date) => date.getDay() === 0;

        const calculateOTHours = (timeOutStr) => {
            if (!timeOutStr) return 0;
            const parts = timeOutStr.split(':');
            if (parts.length < 2) return 0;
            const hours = parseInt(parts[0], 10);
            const minutes = parseInt(parts[1], 10);
            let standardEnd = 17 * 60; 
            let actualEnd = hours * 60 + minutes;
            if (actualEnd <= standardEnd) return 0;
            let diffMinutes = actualEnd - standardEnd;
            if (diffMinutes < 25) return 0;
            let fullHours = Math.floor(diffMinutes / 60);
            let remainingMinutes = diffMinutes % 60;
            let fractionalOT = 0;
            if (remainingMinutes >= 55) fractionalOT = 1.0;
            else if (remainingMinutes >= 45) fractionalOT = 0.75;
            else if (remainingMinutes >= 25) fractionalOT = 0.5;
            if (fractionalOT === 1.0) { fullHours += 1; fractionalOT = 0; }
            return fullHours + fractionalOT;
        };

        const calculateLateMinutes = (timeInStr) => {
            if (!timeInStr) return 0;
            const [h, m] = timeInStr.split(':').map(Number);
            const totalMin = h * 60 + m;
            if (totalMin > 485) return totalMin - 480; 
            return 0;
        };

        const formatMinutesToHrs = (totalMinutes) => {
            const h = Math.floor(totalMinutes / 60);
            const m = totalMinutes % 60;
            return `${h} ‡∏ä‡∏°. ${m} ‡∏ô‡∏≤‡∏ó‡∏µ`;
        }

        // --- Main App ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('data');
            const [scanInput, setScanInput] = useState(SAMPLE_SCAN_DATA);
            const [salaryInput, setSalaryInput] = useState(SAMPLE_SALARY_DATA);
            const [specialHolidays, setSpecialHolidays] = useState([]);
            const [newHoliday, setNewHoliday] = useState('');
            const [isSalaryLoading, setIsSalaryLoading] = useState(false);
            const [isScanLoading, setIsScanLoading] = useState(false);
            const [remarks, setRemarks] = useState({});
            const [processedData, setProcessedData] = useState({});

            useEffect(() => {
                const savedRemarks = localStorage.getItem('ot_system_remarks');
                if (savedRemarks) {
                    try { setRemarks(JSON.parse(savedRemarks)); } catch (e) {}
                }
            }, []);

            const saveRemarks = () => {
                localStorage.setItem('ot_system_remarks', JSON.stringify(remarks));
                alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
            };

            const handleRemarkChange = (id, sortableDate, value) => {
                setRemarks(prev => ({ ...prev, [`${id}|${sortableDate}`]: value }));
            };

            const fetchSalaryData = useCallback(async (isAuto = false) => {
                setIsSalaryLoading(true);
                try {
                    const response = await fetch(SALARY_SHEET_CSV_URL);
                    if (!response.ok) throw new Error();
                    const text = await response.text();
                    setSalaryInput(text);
                    if(!isAuto) alert("‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                } catch (e) { if(!isAuto) alert("‚ùå ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); } 
                finally { setIsSalaryLoading(false); }
            }, []);

            const fetchScanData = useCallback(async (isAuto = false) => {
                setIsScanLoading(true);
                try {
                    const response = await fetch(SCAN_SHEET_CSV_URL);
                    if (!response.ok) throw new Error();
                    const text = await response.text();
                    setScanInput(text);
                    if(!isAuto) alert("‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                } catch (e) { if(!isAuto) alert("‚ùå ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); }
                finally { setIsScanLoading(false); }
            }, []);

            useEffect(() => {
                fetchSalaryData(true);
                fetchScanData(true);
            }, [fetchSalaryData, fetchScanData]);

            const handleExportXLSX = () => {
                if (Object.keys(processedData).length === 0) { alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å"); return; }
                const wb = XLSX.utils.book_new();
                Object.keys(processedData).forEach(id => {
                    const data = processedData[id];
                    const isDaily = data.info.isDaily;
                    const hourlyRate = isDaily ? (DAILY_WAGE_RATE / 8) : (data.info.salary / 30 / 8);
                    const wsData = [
                        ["‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô", id], 
                        ["‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•", data.info.name], 
                        ["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó", isDaily ? "‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô" : (data.info.isLogistics ? "‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå" : "‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô")],
                        ["‡∏ê‡∏≤‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á", isDaily ? DAILY_WAGE_RATE : data.info.salary], 
                        ["‡πÄ‡∏£‡∏ó‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (OT)", hourlyRate], [],
                        ["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", "‡∏ß‡∏±‡∏ô", "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤", "‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏", "‡∏™‡∏≤‡∏¢ (‡∏ô‡∏≤‡∏ó‡∏µ)", "OT (‡∏ä‡∏°.)", "‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì", "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô OT (‡∏™‡∏π‡∏ï‡∏£)"]
                    ];
                    let currentRow = 7;
                    data.records.forEach(rec => {
                        const amountFormula = rec.otHours > 0 ? `H${currentRow}*I${currentRow}*$B$5` : null;
                        const row = [
                            rec.date, rec.dayOfWeek, rec.timeIn || "", rec.timeOut || "", 
                            rec.status, rec.remark || "", 
                            rec.lateMinutes > 0 ? rec.lateMinutes : "", 
                            rec.otHours > 0 ? rec.otHours : 0, 
                            rec.otHours > 0 ? rec.otRate : 0, 
                            { t: 'n', v: rec.amount, f: amountFormula }
                        ];
                        wsData.push(row);
                        currentRow++;
                    });
                    const lastRowIdx = currentRow - 1;
                    const totalLateFormula = `SUM(G7:G${lastRowIdx})`;
                    const totalHoursFormula = `SUM(H7:H${lastRowIdx})`;
                    const totalAmountFormula = `SUM(J7:J${lastRowIdx})`;
                    wsData.push(["‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥", "", "", "", "", "", { t: 'n', v: data.totalLateMinutes, f: totalLateFormula }, { t: 'n', v: data.totalOTHours, f: totalHoursFormula }, "", { t: 'n', v: data.totalOTAmount, f: totalAmountFormula }]);
                    if (isDaily) {
                        currentRow += 2; wsData.push([]); wsData.push(["‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô"]); wsData.push(["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô", data.daysWorked]); wsData.push(["‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô", DAILY_WAGE_RATE]); wsData.push(["‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á (‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏° OT)", { t: 'n', v: data.daysWorked * DAILY_WAGE_RATE, f: `B${currentRow+2}*B${currentRow+3}` }]);
                    }
                    const ws = XLSX.utils.aoa_to_sheet(wsData);
                    XLSX.utils.book_append_sheet(wb, ws, `‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ${id}`);
                });
                XLSX.writeFile(wb, "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô_OT_‡πÅ‡∏•‡∏∞_‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏™‡∏≤‡∏¢.xlsx");
            };

            // --- Processing Logic ---
            useEffect(() => {
                try {
                    const salaryMap = {};
                    salaryInput.split('\n').forEach(line => {
                        if (!line.trim()) return;
                        const cols = parseLine(line);
                        if (cols.length >= 2) {
                            let id, name, salaryStr, dept;
                            const c0 = cols[0].replace(/,/g,'');
                            const c1 = cols[1].replace(/,/g,'');
                            if (!isNaN(c0) && c0) { id = cols[0]; name = cols[1]; salaryStr = cols[2]; dept = cols[3]; } 
                            else if (!isNaN(c1) && c1) { id = cols[1]; name = cols[0]; salaryStr = cols[2]; dept = cols[3]; }
                            if (id) {
                                const deptStr = dept || "";
                                const isDaily = deptStr.includes('‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô');
                                const isLogistics = deptStr.includes('‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå') || deptStr.toLowerCase().includes('logistics');
                                
                                salaryMap[id.trim()] = { 
                                    name: name?.trim(), 
                                    salary: parseFloat(salaryStr?.replace(/,/g, '') || 0), 
                                    isDaily, 
                                    isLogistics,
                                    department: deptStr || '‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô' 
                                };
                            }
                        }
                    });

                    const scanGroups = {}; 
                    let minDate = new Date(8640000000000000);
                    let maxDate = new Date(-8640000000000000);
                    let hasData = false;

                    scanInput.split('\n').forEach(line => {
                        if (!line.trim()) return;
                        const cols = parseLine(line);
                        if (cols.length < 3) return;
                        let id = "", dateStr = "", timeStr = "";
                        const c1Clean = cols[1].replace(/,/g,'');
                        const isC1ID = !isNaN(c1Clean) && c1Clean;
                        if (isC1ID && (cols[2].includes('-') || cols[2].includes('/'))) { id = cols[1].trim(); dateStr = cols[2].trim(); timeStr = cols[3]?.trim(); } 
                        else if (!isNaN(cols[0].replace(/,/g,'')) && (cols[1].includes('-') || cols[1].includes('/'))) { id = cols[0].trim(); dateStr = cols[1].trim(); timeStr = cols[2]?.trim(); }
                        if (id && dateStr && timeStr) {
                            const dObj = parseDate(dateStr);
                            const sortableDate = `${dObj.getFullYear()}-${(dObj.getMonth()+1).toString().padStart(2,'0')}-${dObj.getDate().toString().padStart(2,'0')}`;
                            if (dObj < minDate) minDate = dObj;
                            if (dObj > maxDate) maxDate = dObj;
                            hasData = true;
                            const key = `${id}|${sortableDate}`;
                            if (!scanGroups[key]) scanGroups[key] = [];
                            scanGroups[key].push(timeStr);
                        }
                    });

                    if (!hasData) { setProcessedData({}); return; }

                    const results = {};
                    const idList = Object.keys(salaryMap);

                    idList.forEach(id => {
                        const employeeRecords = [];
                        let totalOTHours = 0; let totalOTAmount = 0; let lateCount = 0; let totalLateMinutes = 0; 
                        let absentCount = 0; let leaveCount = 0; // Added leaveCount
                        let daysWorked = 0;
                        for (let d = new Date(minDate); d <= maxDate; d.setDate(d.getDate() + 1)) {
                            const sortableDate = `${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,'0')}-${d.getDate().toString().padStart(2,'0')}`;
                            const displayDate = formatDate(d);
                            const key = `${id}|${sortableDate}`;
                            const times = scanGroups[key] ? scanGroups[key].sort() : [];
                            const isSun = isSunday(d);
                            const isSpecial = specialHolidays.includes(displayDate) || specialHolidays.includes(sortableDate);
                            let status = "‡∏õ‡∏Å‡∏ï‡∏¥"; let bgColor = ""; let timeIn = ""; let timeOut = ""; let isLate = false; let lateMinutes = 0;
                            const savedRemark = remarks[`${id}|${sortableDate}`] || "";

                            // OT Variables
                            let otHours = 0; 
                            let otRate = (isSun || isSpecial) ? 2.0 : 1.5; 
                            let amount = 0;
                            let isLogisticsBonus = false;

                            if (times.length === 0) {
                                if (isSun || isSpecial) {
                                    bgColor = "bg-gray-200";
                                    status = isSpecial ? "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©" : "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå";
                                } else {
                                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                                    if (savedRemark && savedRemark.trim().length > 0) {
                                        status = "‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô"; 
                                        bgColor = "bg-red-50"; 
                                        leaveCount++; // ‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏≤‡∏á‡∏≤‡∏ô
                                    } else {
                                        status = "‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô/‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"; 
                                        bgColor = "bg-red-100";
                                        absentCount++; // ‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô
                                    }
                                }
                            } else {
                                daysWorked++;
                                timeIn = times[0]; timeOut = times[times.length - 1];
                                if (timeIn > "08:05") { isLate = true; lateCount++; lateMinutes = calculateLateMinutes(timeIn); totalLateMinutes += lateMinutes; }
                                if (times.length === 1) {
                                    if (timeIn > "12:00") { bgColor = "bg-orange-100"; status = "‡πÑ‡∏°‡πà‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤/‡∏°‡∏≤‡∏ö‡πà‡∏≤‡∏¢"; } 
                                    else { bgColor = "bg-orange-100"; status = "‡πÑ‡∏°‡πà‡∏™‡πÅ‡∏Å‡∏ô‡∏≠‡∏≠‡∏Å"; }
                                } else {
                                    const hasMorningScan = times.some(t => t <= "13:00");
                                    const hasAfternoonScan = times.some(t => t > "13:00");
                                    if (times.length > 2 && hasMorningScan && hasAfternoonScan) { bgColor = "bg-purple-100"; status = "‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô"; }
                                }

                                // Logistics Logic: Add 0.5hr if they came to work
                                if (salaryMap[id].isLogistics) {
                                    otHours += LOGISTICS_PREMIUM_HOURS;
                                    isLogisticsBonus = true;
                                }
                            }

                            // Holiday Work Override (Visual & Status)
                            if ((isSun || isSpecial) && times.length > 0) {
                                bgColor = "bg-gray-200"; 
                                status = isSun ? "‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå" : "‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©"; 
                            }
                            
                            // Normal OT Calculation
                            if (times.length > 1) {
                                otHours += calculateOTHours(timeOut);
                            }

                            // Calculate Amount if there is OT (Normal or Premium)
                            if (otHours > 0) {
                                const hourlyRate = salaryMap[id].isDaily ? (DAILY_WAGE_RATE / 8) : (salaryMap[id].salary / 30 / 8);
                                amount = otHours * hourlyRate * otRate;
                                totalOTHours += otHours;
                                totalOTAmount += amount;
                            }

                            employeeRecords.push({ 
                                sortableDate, 
                                date: displayDate, 
                                dayOfWeek: d.toLocaleDateString('th-TH', { weekday: 'long' }), 
                                timeIn, 
                                timeOut, 
                                isLate, 
                                lateMinutes, 
                                status, 
                                bgColor, 
                                otHours, 
                                otRate, 
                                amount, 
                                isSun, 
                                isSpecial, 
                                remark: savedRemark,
                                isLogisticsBonus
                            });
                        }
                        if (employeeRecords.length > 0) {
                            results[id] = { info: salaryMap[id], records: employeeRecords, totalOTHours, totalOTAmount, lateCount, totalLateMinutes, absentCount, leaveCount, daysWorked };
                        }
                    });
                    setProcessedData(results);
                } catch (e) { console.error(e); }
            }, [scanInput, salaryInput, specialHolidays, remarks]);

            // Handlers
            const addHoliday = () => {
                if (newHoliday) { const [y, m, d] = newHoliday.split('-'); const formatted = `${d}/${m}/${y}`; setSpecialHolidays([...specialHolidays, formatted]); setNewHoliday(''); }
            };
            const removeHoliday = (h) => setSpecialHolidays(specialHolidays.filter(d => d !== h));

            return (
                <div className="min-h-screen pb-10">
                    <nav className="bg-blue-800 text-white p-4 shadow-md no-print">
                        <div className="max-w-7xl mx-auto flex justify-between items-center">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <i data-lucide="file-check"></i> ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì OT & ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ (HR Pro)
                            </h1>
                            <div className="space-x-2">
                                <button onClick={() => setActiveTab('data')} className={`px-4 py-2 rounded ${activeTab === 'data' ? 'bg-white text-blue-800' : 'hover:bg-blue-700'}`}>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                                <button onClick={() => setActiveTab('report')} className={`px-4 py-2 rounded ${activeTab === 'report' ? 'bg-white text-blue-800' : 'hover:bg-blue-700'}`}>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
                            </div>
                        </div>
                    </nav>

                    <main className="max-w-7xl mx-auto mt-6 p-4">
                        {activeTab === 'data' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 no-print">
                                <div className="bg-white p-6 rounded shadow">
                                    <h2 className="font-bold mb-4 border-b pb-2">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πÅ‡∏Å‡∏ô (Raw Data)</h2>
                                    <div className="flex justify-between mb-2">
                                        <label className="text-sm text-gray-600">ID ...0BIKU</label>
                                        <button onClick={() => fetchScanData(false)} disabled={isScanLoading} className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">
                                            {isScanLoading ? 'Loading...' : 'üîÑ ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å Sheet'}
                                        </button>
                                    </div>
                                    <textarea className="w-full h-40 p-2 border rounded font-mono text-xs" value={scanInput} onChange={(e) => setScanInput(e.target.value)}></textarea>
                                </div>
                                <div className="bg-white p-6 rounded shadow">
                                    <h2 className="font-bold mb-4 border-b pb-2">2. ‡∏ê‡∏≤‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
                                    <div className="flex justify-between mb-2">
                                        <label className="text-sm text-gray-600">ID ...xyqys</label>
                                        <button onClick={() => fetchSalaryData(false)} disabled={isSalaryLoading} className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">
                                            {isSalaryLoading ? 'Loading...' : 'üîÑ ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å Sheet'}
                                        </button>
                                    </div>
                                    <p className="text-xs text-gray-500 mb-1">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ‡∏£‡∏´‡∏±‡∏™, ‡∏ä‡∏∑‡πà‡∏≠, ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, [‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó(‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô/‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå)]</p>
                                    <textarea className="w-full h-32 p-2 border rounded font-mono text-xs" value={salaryInput} onChange={(e) => setSalaryInput(e.target.value)}></textarea>
                                    
                                    <div className="mt-4">
                                        <label className="text-sm font-bold">‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏Ñ‡∏¥‡∏î OT 2 ‡πÄ‡∏ó‡πà‡∏≤)</label>
                                        <div className="flex gap-2 mt-1">
                                            <input type="date" className="border p-1 rounded flex-1 text-sm" value={newHoliday} onChange={(e) => setNewHoliday(e.target.value)} />
                                            <button onClick={addHoliday} className="bg-green-600 text-white px-3 py-1 rounded text-sm">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                                        </div>
                                        <div className="mt-2 flex flex-wrap gap-2">
                                            {specialHolidays.map(h => (
                                                <span key={h} className="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded border border-yellow-200 flex items-center gap-1">
                                                    {h} <button onClick={() => removeHoliday(h)} className="text-red-500 font-bold">x</button>
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <div className="col-span-1 md:col-span-2 bg-blue-50 p-4 rounded text-sm text-blue-800 border border-blue-200">
                                    <p className="font-bold">üìò ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏µ:</p>
                                    <div className="flex flex-wrap gap-4 mt-2">
                                        <span className="flex items-center gap-1"><span className="w-4 h-4 bg-gray-200 border"></span> ‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå/‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©</span>
                                        <span className="flex items-center gap-1"><span className="w-4 h-4 bg-red-100 border"></span> ‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                                        <span className="flex items-center gap-1"><span className="w-4 h-4 bg-red-50 border"></span> ‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏)</span>
                                        <span className="flex items-center gap-1"><span className="w-4 h-4 bg-orange-100 border"></span> ‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤/‡∏≠‡∏≠‡∏Å (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö)</span>
                                        <span className="flex items-center gap-1"><span className="w-4 h-4 bg-purple-100 border"></span> ‡∏≠‡∏≠‡∏Å‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô (‡∏•‡∏≤‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏û‡∏±‡∏Å)</span>
                                        <span className="flex items-center gap-1"><span className="text-red-600 font-bold">12:00</span> ‡∏™‡∏≤‡∏¢ (>08:05)</span>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'report' && (
                            <div className="space-y-8">
                                <div className="no-print flex justify-end gap-2 sticky top-0 bg-white p-2 shadow-sm z-10 border-b">
                                    <div className="flex items-center text-sm text-gray-500 mr-4">
                                        <i data-lucide="info" className="w-4 h-4 mr-1"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                                    </div>
                                    <button onClick={saveRemarks} className="bg-blue-600 text-white px-4 py-2 rounded shadow hover:bg-blue-700 flex items-center gap-2">
                                        <i data-lucide="save"></i> üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
                                    </button>
                                    <button onClick={handleExportXLSX} className="bg-green-600 text-white px-4 py-2 rounded shadow hover:bg-green-700 flex items-center gap-2">
                                        <i data-lucide="sheet"></i> üì• Excel
                                    </button>
                                    <button onClick={() => window.print()} className="bg-gray-800 text-white px-4 py-2 rounded shadow hover:bg-black">
                                        üñ® ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                                    </button>
                                </div>
                                {Object.keys(processedData).length === 0 ? <div className="text-center p-10 text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div> :
                                <div id="report-container" className="print-container">
                                {Object.keys(processedData).map(id => {
                                    const data = processedData[id];
                                    return (
                                        <div key={id} className="employee-container page-break screen-page">
                                            <div className="bg-white p-6">
                                            
                                            {/* Modified Header Layout */}
                                            <div className="border-b-2 border-black pb-2 mb-4">
                                                <div className="flex justify-between items-end">
                                                    <div className="flex items-baseline gap-3">
                                                        <h1 className="text-xl font-bold whitespace-nowrap">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</h1>
                                                        <span className="text-sm text-gray-600 flex items-baseline gap-1">
                                                            ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: 
                                                            <span className="text-lg font-semibold text-black">{data.info.name}</span> 
                                                            ({id})
                                                        </span>
                                                        {data.info.isDaily && <span className="bg-green-100 text-green-800 text-xs px-2 py-0.5 rounded border border-green-200 font-bold whitespace-nowrap">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</span>}
                                                        {data.info.isLogistics && <span className="bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded border border-blue-200 font-bold whitespace-nowrap">Logistics +0.5/‡∏ß‡∏±‡∏ô</span>}
                                                    </div>
                                                    <div className="text-right text-sm whitespace-nowrap">
                                                        <p>{data.info.isDaily ? '‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô' : '‡∏ê‡∏≤‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}: {data.info.isDaily ? DAILY_WAGE_RATE : data.info.salary.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <table className="w-full text-xs border-collapse">
                                                <thead>
                                                    <tr className="bg-gray-100 border-b border-black">
                                                        <th className="p-1 border text-left w-20">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                                        <th className="p-1 border text-left w-24">‡∏ß‡∏±‡∏ô</th> 
                                                        <th className="p-1 border text-center w-12">‡πÄ‡∏Ç‡πâ‡∏≤</th>
                                                        <th className="p-1 border text-center w-12">‡∏≠‡∏≠‡∏Å</th>
                                                        <th className="p-1 border text-left w-32">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                                        <th className="p-1 border text-left">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                                        <th className="p-1 border text-right w-12">OT(‡∏ä‡∏°.)</th>
                                                        <th className="p-1 border text-center w-8">‡∏Ñ‡∏π‡∏ì</th>
                                                        <th className="p-1 border text-right w-16">‡πÄ‡∏á‡∏¥‡∏ô</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {data.records.map((rec, idx) => (
                                                        <tr key={idx} className={`${rec.bgColor} border-b border-gray-300`}>
                                                            <td className="p-1 border">{rec.date}</td>
                                                            <td className="p-1 border text-gray-600">{rec.dayOfWeek}</td>
                                                            <td className={`p-1 border text-center ${rec.isLate ? 'text-red-600 font-bold' : ''}`}>
                                                                {rec.timeIn || '-'}
                                                            </td>
                                                            <td className="p-1 border text-center">{rec.timeOut || '-'}</td>
                                                            <td className="p-1 border text-gray-700">
                                                                {rec.isSpecial && <span className="bg-yellow-200 px-1 rounded mr-1">‡∏ô‡∏±‡∏Å‡∏Ç‡∏±‡∏ï‡∏Ø</span>}
                                                                {rec.isLate && <span className="text-red-600 mr-1">[‡∏™‡∏≤‡∏¢]</span>}
                                                                {rec.status}
                                                            </td>
                                                            <td className="p-0 border relative">
                                                                {/* Hidden in screen, visible in print */}
                                                                <span className="print-only p-1 text-xs absolute top-0 left-0">{rec.remark}</span>
                                                                {/* Visible in screen, hidden in print */}
                                                                <input 
                                                                    type="text" 
                                                                    className="no-print w-full h-full p-1 bg-transparent focus:bg-white focus:outline-none placeholder-gray-400 text-blue-800"
                                                                    placeholder="..."
                                                                    value={rec.remark}
                                                                    onChange={(e) => handleRemarkChange(id, rec.sortableDate, e.target.value)}
                                                                />
                                                            </td>
                                                            <td className="p-1 border text-right font-medium relative group">
                                                                {rec.otHours > 0 ? rec.otHours : '-'}
                                                                {rec.isLogisticsBonus && <span className="absolute -top-2 -right-2 bg-blue-500 text-white text-[8px] px-1 rounded-full no-print">+0.5</span>}
                                                            </td>
                                                            <td className="p-1 border text-center text-gray-500">{rec.otHours > 0 ? `x${rec.otRate}` : ''}</td>
                                                            <td className="p-1 border text-right">{rec.amount > 0 ? rec.amount.toLocaleString(undefined, {minimumFractionDigits:2}) : '-'}</td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                                <tfoot>
                                                    <tr className="bg-gray-100 font-bold border-t-2 border-black">
                                                        <td colSpan="6" className="p-2 text-right">‡∏£‡∏ß‡∏° OT ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</td>
                                                        <td className="p-2 text-right">{data.totalOTHours}</td>
                                                        <td></td>
                                                        <td className="p-2 text-right">{data.totalOTAmount.toLocaleString(undefined, {minimumFractionDigits:2})}</td>
                                                    </tr>
                                                </tfoot>
                                            </table>

                                            <div className="mt-4 border p-4 rounded bg-gray-50 print:bg-white print:border-gray-400 break-inside-avoid">
                                                <div className="flex justify-between items-end">
                                                    <div className="flex-1">
                                                        <h3 className="font-bold underline mb-2">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h3>
                                                        {data.info.isDaily && (
                                                            <div className="mb-3 p-2 bg-green-50 border border-green-200 rounded print:bg-transparent print:border-black">
                                                                <p className="font-bold text-green-800 border-b border-green-200 mb-1 print:text-black print:border-black">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</p>
                                                                <p className="flex justify-between w-64"><span>‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:</span> <b>{data.daysWorked} ‡∏ß‡∏±‡∏ô</b></p>
                                                                <p className="flex justify-between w-64"><span>‡πÄ‡∏£‡∏ó:</span> <span>{DAILY_WAGE_RATE} ‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô</span></p>
                                                                <p className="flex justify-between w-64 font-bold text-lg mt-1"><span>‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á:</span> <span>{(data.daysWorked * DAILY_WAGE_RATE).toLocaleString()} ‡∏ö‡∏≤‡∏ó</span></p>
                                                                <p className="text-xs text-gray-500 mt-1">*‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î OT ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á</p>
                                                            </div>
                                                        )}
                                                        
                                                        {/* Modified Summary Layout: Inline Late and Absent */}
                                                        <div className="flex flex-wrap gap-6 border-b border-dotted py-1 mb-2">
                                                            <span>
                                                                <span className="text-red-600 print:text-black">‡∏°‡∏≤‡∏™‡∏≤‡∏¢:</span> <b>{data.lateCount}</b> ‡∏ß‡∏±‡∏ô 
                                                                <span className="text-gray-600 print:text-black text-xs ml-1">({formatMinutesToHrs(data.totalLateMinutes)})</span>
                                                            </span>
                                                            {/* ‡πÅ‡∏¢‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô/‡∏•‡∏≤ */}
                                                            <span>
                                                                <span className="text-red-600 print:text-black">‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô/‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</span> <b>{data.absentCount}</b> ‡∏ß‡∏±‡∏ô
                                                            </span>
                                                            {data.leaveCount > 0 && (
                                                                <span>
                                                                    <span className="text-orange-600 print:text-black">‡∏•‡∏≤/‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span> <b>{data.leaveCount}</b> ‡∏ß‡∏±‡∏ô
                                                                </span>
                                                            )}
                                                        </div>
                                                        
                                                        <div className="text-xs text-gray-500">
                                                            <p className="font-semibold text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</p>
                                                            <ul className="list-disc list-inside">
                                                                {data.records.filter(r => r.remark).map((r, i) => (
                                                                    <li key={i}>{r.date}: {r.remark}</li>
                                                                ))}
                                                                {!data.records.some(r => r.remark) && <li>-</li>}
                                                            </ul>
                                                        </div>
                                                    </div>

                                                    {/* Modified Signature Section */}
                                                    <div className="text-right pl-4">
                                                        <div className="inline-block w-40 border-b border-black text-center pb-1"></div>
                                                        <div className="inline-block w-40 text-center text-xs text-gray-500">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö)</div>
                                                    </div>
                                                </div>
                                            </div>
                                            </div>
                                        </div>
                                    );
                                })}
                                </div>
                                }
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
